<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDBoPIbHabZnjdScsTyFi3osVyPp88KuSM",
    authDomain: "pantrypal-6e410.firebaseapp.com",
    projectId: "pantrypal-6e410",
    storageBucket: "pantrypal-6e410.firebasestorage.app",
    messagingSenderId: "592127259891",
    appId: "1:592127259891:web:fcc158b7b1c35ce0b3b386",
    measurementId: "G-P641JW4KS4"
  };

  firebase.initializeApp(firebaseConfig);

  // === Firebase UI â€“ Only show enabled providers ===
  const ui = new firebaseui.auth.AuthUI(firebase.auth());
  ui.start('#firebaseui-auth-container', {
    signInFlow: 'popup',
    signInOptions: [
      // Google
      firebase.auth.GoogleAuthProvider.PROVIDER_ID,

      // Apple
      {
        provider: firebase.auth.OAuthProvider.PROVIDER_ID,
        providerId: 'apple.com',
        fullLabel: 'Continue with Apple'
      },

      // Email/Password
      {
        provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,
        requireDisplayName: false,
        fullLabel: 'Continue with Email'
      },

      // Phone
      {
        provider: firebase.auth.PhoneAuthProvider.PROVIDER_ID,
        recaptchaParameters: {
          size: 'invisible'
        },
        defaultCountry: 'US',
        fullLabel: 'Continue with Phone'
      }
    ],
    callbacks: {
      signInSuccessWithAuthResult: () => false
    }
  });

  let currentUser = null;
  let idToken = null;
  let familyCode = null;

  firebase.auth().onAuthStateChanged(async user => {
    if (user) {
      currentUser = user;
      idToken = await user.getIdToken();
      document.getElementById('userEmail').textContent = user.email || user.phoneNumber || 'User';
      document.getElementById('auth-section').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
      loadInventory();
      loadShopping();
      loadScanCount();
      loadFamily();
    } else {
      document.getElementById('auth-section').classList.remove('hidden');
      document.getElementById('app').classList.add('hidden');
    }
  });

  document.getElementById('signOutBtn').onclick = () => firebase.auth().signOut();

  // === API Helper ===
  async function api(path, opts = {}) {
    if (!idToken) return alert('Not signed in');
    const res = await fetch(path, {
      ...opts,
      headers: {
        'Authorization': `Bearer ${idToken}`,
        'Content-Type': 'application/json',
        ...opts.headers
      }
    });
    if (!res.ok) { const err = await res.text(); alert('API Error: ' + err); return null; }
    return res.json();
  }

  // ... [rest of your existing JS: dark mode, voice, scanner, etc.]
</script>
