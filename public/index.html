<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PantryPal Pro</title>
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>

  <!-- Firebase SDKs (latest compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>

  <!-- Barcode scanner + voice -->
  <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.20.1/umd/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/annyang@2.6.1/annyang.min.js"></script>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .glass { background: rgba(255,255,255,0.15); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.2); }
    .dark .glass { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); }
    .tab-active { @apply bg-white text-purple-600 dark:bg-gray-800 dark:text-purple-400; }
    .delete-btn { @apply text-red-500 hover:text-red-700 font-bold text-sm; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-600 to-blue-600 text-gray-900 dark:text-white transition-colors">

  <!-- AUTH SCREEN -->
  <div id="auth-section" class="flex items-center justify-center min-h-screen">
    <div class="glass p-12 rounded-3xl shadow-2xl max-w-md w-full text-center">
      <h1 class="text-5xl font-bold mb-8">PantryPal Pro</h1>
      <button id="googleSignIn" class="w-full px-8 py-4 bg-white text-gray-800 rounded-2xl font-bold text-lg shadow-lg hover:shadow-xl transition flex items-center justify-center gap-4">
        <img src="https://www.gstatic.com/firebasejs/ui/6.0.1/images/auth/google.svg" alt="Google" class="w-6 h-6">
        Sign in with Google
      </button>
      <p class="mt-6 text-sm opacity-70">Unlock inventory, AI scan, voice commands & more</p>
    </div>
  </div>

  <!-- MAIN APP -->
  <div id="app" class="hidden min-h-screen">
    <header class="glass sticky top-0 z-50 shadow-lg">
      <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
        <div class="flex items-center space-x-4">
          <h1 class="text-3xl font-bold">PantryPal Pro</h1>
          <span id="userEmail" class="text-sm opacity-80"></span>
        </div>
        <div class="flex items-center space-x-4">
          <span id="scanCounter" class="text-sm font-medium bg-yellow-400 text-black px-3 py-1 rounded-full"></span>
          <button id="darkModeBtn" class="p-2 rounded-lg glass">Dark Mode</button>
          <button id="signOutBtn" class="px-6 py-2 bg-red-500 text-white rounded-xl font-semibold hover:bg-red-600">Sign Out</button>
        </div>
      </div>
    </header>

    <main class="max-w-6xl mx-auto px-6 py-10">
      <div class="flex space-x-4 mb-8 overflow-x-auto">
        <button class="tab-btn tab-active px-6 py-3 rounded-xl font-bold" data-tab="inventory">Inventory</button>
        <button class="tab-btn px-6 py-3 rounded-xl font-bold" data-tab="shopping">Shopping List</button>
        <button class="tab-btn px-6 py-3 rounded-xl font-bold" data-tab="scanner">Scanner</button>
        <button class="tab-btn px-6 py-3 rounded-xl font-bold" data-tab="voice">Voice</button>
        <button class="tab-btn px-6 py-3 rounded-xl font-bold" data-tab="ai">AI Scan (Pro)</button>
      </div>

      <!-- INVENTORY -->
      <section id="inventory">
        <div class="glass p-8 rounded-3xl">
          <h2 class="text-2xl font-bold mb-6">Add to Inventory</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <input id="invBarcode" type="text" placeholder="Barcode" class="px-4 py-3 rounded-xl glass"/>
            <input id="invQty" type="number" value="1" min="1" class="px-4 py-3 rounded-xl glass"/>
            <input id="invExp" type="date" class="px-4 py-3 rounded-xl glass"/>
          </div>
          <button id="addToInventory" class="px-8 py-4 bg-green-500 text-white rounded-xl font-bold hover:bg-green-600">Add Item</button>
          <div id="inventoryList" class="mt-8 space-y-4"></div>
        </div>
      </section>

      <!-- SHOPPING LIST -->
      <section id="shopping" class="hidden">
        <div class="glass p-8 rounded-3xl">
          <h2 class="text-2xl font-bold mb-6">Shopping List</h2>
          <div class="flex space-x-4 mb-6">
            <input id="shopName" type="text" placeholder="Item name" class="flex-1 px-4 py-3 rounded-xl glass"/>
            <input id="shopNeeded" type="number" value="1" min="1" class="w-24 px-4 py-3 rounded-xl glass"/>
          </div>
          <button id="addToShopping" class="px-8 py-4 bg-blue-500 text-white rounded-xl font-bold hover:bg-blue-600">Add to List</button>
          <div id="shoppingList" class="mt-8 space-y-4"></div>
        </div>
      </section>

      <!-- SCANNER, VOICE, AI SCAN sections unchanged (kept for brevity) -->
      <!-- Copy-paste your existing scanner/voice/ai sections here if needed -->

    </main>
  </div>

  <script>
    lucide.createIcons();
    const API_BASE = window.location.origin;

    // Your Firebase config (working)
    const firebaseConfig = {
      apiKey: "AIzaSyDBoPIbHabZnjdScsTyFi3osVyPp88KuSM",
      authDomain: "pantrypal-6e410.firebaseapp.com",
      projectId: "pantrypal-6e410",
      storageBucket: "pantrypal-6e410.firebasestorage.app",
      messagingSenderId: "592127259891",
      appId: "1:592127259891:web:fcc158b7b1c35ce0b3b386"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    let idToken = null;
    const $ = s => document.querySelector(s);

    // DIRECT GOOGLE SIGN-IN (THIS FIXES EVERYTHING)
    document.getElementById('googleSignIn').addEventListener('click', () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then(result => {
          console.log('Logged in as', result.user.displayName);
        })
        .catch(error => {
          console.error('Login failed:', error);
          alert('Login failed: ' + error.message);
        });
    });

    // Auth state listener
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        idToken = await user.getIdToken();
        $('#userEmail').textContent = user.email;
        $('#auth-section').classList.add('hidden');
        $('#app').classList.remove('hidden');
        loadInventory();
        loadShopping();
        loadScanCount();
      }
    });

    $('#signOutBtn').onclick = () => auth.signOut();

    // Your existing api(), loadInventory(), loadShopping(), etc. functions go here
    // (Keep everything you already have below this point)

    async function api(path, opts = {}) {
      if (!idToken) return null;
      const res = await fetch(API_BASE + path, {
        ...opts,
        headers: { 'Authorization': `Bearer ${idToken}`, 'Content-Type': 'application/json', ...opts.headers }
      });
      return res.ok ? await res.json() : null;
    }

    async function loadInventory() { /* your code */ }
    async function loadShopping() { /* your code */ }
    async function loadScanCount() { /* your code */ }

    console.log('PantryPal Pro loaded â€“ Google login ready!');
  </script>
</body>
</html>
